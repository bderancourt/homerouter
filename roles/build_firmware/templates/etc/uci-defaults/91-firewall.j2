#!/bin/sh

# Firewall configuration for OpenWRT
# This script configures firewall zones, forwarding rules, and access rules

#######################################
# Firewall zones
#######################################

# Guest zone
GUEST_ZONE=$(uci add firewall zone)
uci set firewall.$GUEST_ZONE.name='guest'
uci del firewall.$GUEST_ZONE.network
uci add_list firewall.$GUEST_ZONE.network='guest'
uci set firewall.$GUEST_ZONE.input='ACCEPT'
uci set firewall.$GUEST_ZONE.output='ACCEPT'
uci set firewall.$GUEST_ZONE.forward='REJECT'

# IoT zone
IOT_ZONE=$(uci add firewall zone)
uci set firewall.$IOT_ZONE.name='iot'
uci del firewall.$IOT_ZONE.network
uci add_list firewall.$IOT_ZONE.network='iot'
uci set firewall.$IOT_ZONE.input='ACCEPT'
uci set firewall.$IOT_ZONE.output='ACCEPT'
uci set firewall.$IOT_ZONE.forward='REJECT'

#######################################
# Forwarding rules
#######################################

# LAN to Guest
LAN_GUEST_FORWARDING=$(uci add firewall forwarding)
uci set firewall.$LAN_GUEST_FORWARDING.src='lan'
uci set firewall.$LAN_GUEST_FORWARDING.dest='guest'

# LAN to IoT
LAN_IOT_FORWARDING=$(uci add firewall forwarding)
uci set firewall.$LAN_IOT_FORWARDING.src='lan'
uci set firewall.$LAN_IOT_FORWARDING.dest='iot'

# Guest to IoT
GUEST_IOT_FORWARDING=$(uci add firewall forwarding)
uci set firewall.$GUEST_IOT_FORWARDING.src='guest'
uci set firewall.$GUEST_IOT_FORWARDING.dest='iot'

# Guest to WAN
GUEST_WAN_FORWARDING=$(uci add firewall forwarding)
uci set firewall.$GUEST_WAN_FORWARDING.src='guest'
uci set firewall.$GUEST_WAN_FORWARDING.dest='wan'

# IoT to WAN
LAN_IOT_FORWARDING=$(uci add firewall forwarding)
uci set firewall.$LAN_IOT_FORWARDING.src='iot'
uci set firewall.$LAN_IOT_FORWARDING.dest='wan'

uci commit firewall
exit 0
