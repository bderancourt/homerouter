#!/bin/sh

#######################################
# Bouygues tel FTTH wan specific config
#######################################
# Defaut configuration:
# network.loopback=interface
# network.loopback.device='lo'
# network.loopback.proto='static'
# network.loopback.ipaddr='127.0.0.1'
# network.loopback.netmask='255.0.0.0'
# network.globals=globals
# network.globals.ula_prefix='fd18:f9a1:17c5::/48'
# network.@device[0]=device
# network.@device[0].name='br-lan'
# network.@device[0].type='bridge'
# network.@device[0].ports='eth0'
# network.lan=interface
# network.lan.device='br-lan'
# network.lan.proto='static'
# network.lan.ipaddr='192.168.1.1'
# network.lan.netmask='255.255.255.0'
# network.lan.ip6assign='60'
# network.wan=interface
# network.wan.device='eth1'
# network.wan.proto='dhcp'
# network.wan6=interface
# network.wan6.device='eth1'
# network.wan6.proto='dhcpv6'

uci set network.lan.ipaddr='{{ inventory_hostname }}'

{% if not inventory_hostname.endswith('56.2') %}
# Set WAN port mac address to the one from the Bouygtel box on the physical interface
uci add network device
uci set network.@device[1].name='{{ build_firmware_wan_port }}'
uci set network.@device[1].macaddr='{{ bbox_mac }}'

# Create VLAN 100 on wan interface, used by Bouygtel, set the MAC interface
uci add network device
uci set network.@device[2].name='{{ build_firmware_wan_port }}.100'
uci set network.@device[2].type='8021q'
uci set network.@device[2].ifname='{{ build_firmware_wan_port }}'
uci set network.@device[2].vid='100'
uci set network.@device[2].macaddr='{{ bbox_mac }}'

# WAN interface configuration
uci set network.wan.device='{{ build_firmware_wan_port }}.100'
uci set network.wan.vendorid='BYGTELIAD'
uci set network.wan.norelease='1'
uci set network.wan.delegate='0'
uci set network.wan.hostname='*'

# WAN6 interface configuration
uci set network.wan6.device='@wan'
uci set network.wan6.norelease='1'
uci set network.wan6.reqaddress='none'
uci set network.wan6.reqprefix='60'
{% endif %}