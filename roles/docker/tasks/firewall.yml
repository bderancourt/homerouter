---
- name: Create firewall zone {{ service }}
  uci:
    command: section
    config: firewall
    type: zone
    find-by:
      name: "{{ service }}"
    value:
      input: ACCEPT
      output: ACCEPT
      forward: REJECT
      network:
        - "{{ service }}"
  notify: Restart firewall

- name: Create forwarding Lan to {{ service }}
  uci:
    command: section
    config: firewall
    type: forwarding
    find-by:
      src: lan
      dest: "{{ service }}"
  notify: Restart firewall

- name: Create forwarding to Wan for {{ service }}
  uci:
    command: section
    config: firewall
    type: forwarding
    find-by:
      src: "{{ service }}"
      dest: wan
  notify: Restart firewall

- name: Commit firewall changes
  uci:
    command: commit
    config: firewall
  notify: Restart firewall
